/*
 * Generated by MyEclipse Struts
 * Template path: templates/java/JavaClass.vtl
 */
package org.xpup.hafmis.sysloan.loanapply.loanapply.action;

import java.util.HashMap;
import java.util.Map;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import org.apache.struts.action.Action;
import org.apache.struts.action.ActionForm;
import org.apache.struts.action.ActionForward;
import org.apache.struts.action.ActionMapping;
import org.apache.struts.action.ActionMessage;
import org.apache.struts.action.ActionMessages;
import org.xpup.common.exception.BusinessException;
import org.xpup.common.util.BSUtils;
import org.xpup.hafmis.common.util.BusiConst;
import org.xpup.hafmis.common.util.BusiTools;
import org.xpup.hafmis.orgstrct.dto.SecurityInfo;
import org.xpup.hafmis.sysloan.loanapply.loanapply.bsinterface.ILoanapplyBS;
import org.xpup.hafmis.sysloan.loanapply.loanapply.form.LoanapplyTdNewAF;

/**
 * MyEclipse Struts Creation date: 10-02-2007 XDoclet definition:
 * 
 * @struts.action path="/loanapplytdshowAC" name="loanapplytdnewAF"
 *                scope="request" validate="true"
 */
public class LoanapplyTdShowAC extends Action {

  public ActionForward execute(ActionMapping mapping, ActionForm form,
      HttpServletRequest request, HttpServletResponse response) {

    LoanapplyTdNewAF loanapplytdnewAF = new LoanapplyTdNewAF();
    ActionMessages messages = null;
    SecurityInfo securityInfo = (SecurityInfo) request.getSession()
        .getAttribute("SecurityInfo");
    request.getSession().setAttribute(LoanapplyTeShowAC.PAGINATION_KEY, null);
    ILoanapplyBS loanapplyBS = (ILoanapplyBS) BSUtils.getBusinessService(
        "loanapplyBS", this, mapping.getModuleConfig());
    String contractIdHL = (String) request.getSession().getAttribute(
        "contractIdHL");// 判断是否是从维护的超链接过来的
    String contractid = (String) request.getSession()
        .getAttribute("contractid");// 取出合同编号
    if (contractIdHL != null) {
      contractid = contractIdHL;
    }
    String remend = (String) request.getSession().getAttribute("remend");// 判断是否是维护过来的

    if (contractid != null) {
      try {
        loanapplytdnewAF = loanapplyBS.showBorrowerLoanInfoByContractid1(
            contractid, securityInfo);
      } catch (BusinessException e) {
        messages = new ActionMessages();
        messages.add(ActionMessages.GLOBAL_MESSAGE, new ActionMessage(e
            .getLocalizedMessage().toString(), false));
        saveErrors(request, messages);
      }
    }
    if (remend != null) {
      loanapplytdnewAF.setTemp_ty("1");// 合同编号按钮禁用
    }
    if (contractIdHL != null) {
      loanapplytdnewAF.setCoodm("15");
    }
    try {
      Map loanMoodMap = BusiTools.listBusiProperty(BusiConst.PLRECOVERTYPE);
      Map loanMoodNewMap = new HashMap();
      loanMoodNewMap.put(new Integer(BusiConst.PLRECOVERTYPE_INTEREST),
          loanMoodMap.get(new Integer(BusiConst.PLRECOVERTYPE_INTEREST)));
      loanMoodNewMap.put(new Integer(BusiConst.PLRECOVERTYPE_CORPUS),
          loanMoodMap.get(new Integer(BusiConst.PLRECOVERTYPE_CORPUS)));
      loanapplytdnewAF.setLoanMoodMap(loanMoodNewMap);
    } catch (Exception e) {
      // TODO Auto-generated catch block
      e.printStackTrace();
    }
    String tdsetIsNeedDel = (String) request.getSession().getAttribute(
        "tdsetIsNeedDel");
    loanapplytdnewAF.setIsNeedDel(tdsetIsNeedDel);
    request.getSession().setAttribute("tdsetIsNeedDel", null);
    request.setAttribute("loanapplytdnewAF", loanapplytdnewAF);

    return mapping.findForward("loanapplytd_new");
  }
}