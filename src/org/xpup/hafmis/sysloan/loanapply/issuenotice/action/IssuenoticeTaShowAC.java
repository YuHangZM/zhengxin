/*
 * Generated by MyEclipse Struts
 * Template path: templates/java/JavaClass.vtl
 */
package org.xpup.hafmis.sysloan.loanapply.issuenotice.action;

import java.math.BigDecimal;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import org.apache.struts.action.Action;
import org.apache.struts.action.ActionForm;
import org.apache.struts.action.ActionForward;
import org.apache.struts.action.ActionMapping;
import org.xpup.common.util.BSUtils;
import org.xpup.hafmis.orgstrct.dto.SecurityInfo;
import org.xpup.hafmis.sysloan.loanapply.issuenotice.bsinterface.IIssuenoticeBS;
import org.xpup.hafmis.sysloan.loanapply.issuenotice.dto.IssuenoticeTaDTO;
import org.xpup.hafmis.sysloan.loanapply.issuenotice.form.IssuenoticeTaAF;

/**
 * MyEclipse Struts Creation date: 09-20-2007 XDoclet definition:
 * 
 * @struts.action validate="true"
 */
public class IssuenoticeTaShowAC extends Action {
  /*
   * Generated Methods
   */

  /**
   * Method execute
   * 
   * @param mapping
   * @param form
   * @param request
   * @param response
   * @return ActionForward
   */
  public ActionForward execute(ActionMapping mapping, ActionForm form,
      HttpServletRequest request, HttpServletResponse response) {
    // TODO Auto-generated method stub

    try {
      IssuenoticeTaAF issuenoticeTaAF = new IssuenoticeTaAF();
      issuenoticeTaAF.setLoanMoney(null);
      issuenoticeTaAF.setCorpusInterest(null);
      issuenoticeTaAF.setLoanMonthRate(null);
      String borrowerName = "";// 借款人姓名
      String cardKind = "";// 证件类型
      String cardNum = "";// 证件号码
      String loanBankId = "";// 放款银行
      BigDecimal loanMoney = new BigDecimal(0.00);// 借款金额
      String loanTimeLimit = "";// 借款期限
      BigDecimal loanMonthRate = new BigDecimal(0.00);// 每月利率
      BigDecimal corpusInterest = new BigDecimal(0.00);// 月还本息
      String loanMode = "";// 还款方式
      String sellerPayBank = "";// 划款银行
      String sellerPayBankAcc = "";// 划款银行账号
      String bizDate = "";// 拨款日期：默认为会计日期
      SecurityInfo securityInfo = (SecurityInfo) request.getSession()
          .getAttribute("SecurityInfo");
      bizDate = securityInfo.getUserInfo().getPlbizDate();// 会计日期
      IIssuenoticeBS issuenoticeBS = (IIssuenoticeBS) BSUtils
          .getBusinessService("issuenoticeBS", this, mapping.getModuleConfig());
      String contractId = (String) request.getSession().getAttribute(
          "contractId");
      if (contractId != null){
        issuenoticeTaAF.setType("1");
        request.getSession().setAttribute("contractId", null);
      }
      else{
        contractId = request.getParameter("contractId");
        if (contractId != null)
          issuenoticeTaAF.setType("2");
        else {
          contractId = (String) request.getAttribute("contractId");
          if(contractId != null)
            issuenoticeTaAF.setType("3");
        }
      }
      if (contractId != null) {
        String houseType = issuenoticeBS.findHouseType(contractId);
        IssuenoticeTaDTO issuenoticeTaDTO = issuenoticeBS
            .findIssuenoticeTaInfo(contractId, houseType);
        borrowerName = issuenoticeTaDTO.getBorrowerName();
        cardKind = issuenoticeTaDTO.getTemp_cardKind();
        cardNum = issuenoticeTaDTO.getCardNum();
        loanMode = issuenoticeTaDTO.getTemp_loanMode();
        loanBankId = issuenoticeTaDTO.getLoanBankId();
        loanMoney = issuenoticeTaDTO.getLoanMoney();
        loanTimeLimit = issuenoticeTaDTO.getLoanTimeLimit();
        loanMonthRate = issuenoticeTaDTO.getLoanMonthRate();
        corpusInterest = issuenoticeTaDTO.getCorpusInterest();
        sellerPayBank = issuenoticeTaDTO.getSellerPayBank();
        sellerPayBankAcc = issuenoticeTaDTO.getSellerPayBankAcc();
        String houseTotalPrice = issuenoticeTaDTO.getHouseTotalPrice();
        String houseArea = issuenoticeTaDTO.getHouseArea();
        String houseAddr = issuenoticeTaDTO.getHouseAddr();
        issuenoticeTaAF.setLoanKouAcc(issuenoticeTaDTO.getLoanKouAcc());
        issuenoticeTaAF.setCardKind(cardKind);
        issuenoticeTaAF.setCardNum(cardNum);
        issuenoticeTaAF.setContractId(contractId);
        issuenoticeTaAF.setBizDate(bizDate);
        issuenoticeTaAF.setBorrowerName(borrowerName);
        issuenoticeTaAF.setLoanBankId(loanBankId);
        issuenoticeTaAF.setLoanMode(loanMode);
        issuenoticeTaAF.setLoanMoney(loanMoney);
        issuenoticeTaAF.setCorpusInterest(corpusInterest);
        issuenoticeTaAF.setTemp_loanMonthRate(String.valueOf(loanMonthRate
            .multiply(new BigDecimal(1000))
            + "‰"));
        issuenoticeTaAF.setLoanTimeLimit(String.valueOf(Integer
            .parseInt(loanTimeLimit) / 12));
        issuenoticeTaAF.setSellerPayBank(sellerPayBank);
        issuenoticeTaAF.setSellerPayBankAcc(sellerPayBankAcc);
        issuenoticeTaAF.setBizDate(bizDate);
        issuenoticeTaAF.setHouseTotalPrice(houseTotalPrice);
        issuenoticeTaAF.setHouseArea(houseArea);
        issuenoticeTaAF.setHouseAddr(houseAddr);
      }
      request.setAttribute("issuenoticeTaAF", issuenoticeTaAF);
    } catch (Exception e) {
      // TODO: handle exception
      e.printStackTrace();
    }
    return mapping.findForward("to_loanerlogoutta_show");
  }
}